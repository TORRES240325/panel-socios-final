{% extends "base.html" %}

{% block title %}Gestión de Productos{% endblock %}

{% block content %}
    <h1>Gestión de Productos</h1>

    <a href="{{ url_for('create_product') }}" class="button-red" style="float: right;">+ Agregar Nuevo Producto</a>
    <div style="clear: both; margin-bottom: 20px;"></div>

    <h2>Lista de Productos</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>NOMBRE</th>
                <th>PRECIO</th>
                <th>STOCK DISPONIBLE</th>
                <th>ACCIONES</th>
            </tr>
        </thead>
        <tbody>
            {% if productos %}
                {% for producto in productos %}
                    <tr>
                        <td>{{ producto.id }}</td>
                        <td>{{ producto.nombre }} ({{ producto.categoria }})</td>
                        <td style="font-weight: bold; color: #66FF66;">${{ "%.2f"|format(producto.precio) }}</td>
                        <td>
                            <strong class="{{ 'stock-low' if producto.stock_available < 5 else 'stock-ok' }}">
                                {{ producto.stock_available }}
                            </strong>
                        </td>
                        <td>
                            <a href="{{ url_for('manage_keys', product_id=producto.id) }}" class="button-red" style="background-color: #00A000; margin-right: 5px; padding: 8px 15px;">Inventario (Keys)</a>
                            <a href="{{ url_for('edit_product', product_id=producto.id) }}" class="button-red" style="background-color: #007BFF; margin-right: 5px; padding: 8px 15px;">Editar</a>
                            <form method="POST" action="{{ url_for('delete_product', product_id=producto.id) }}" style="display:inline;">
                                <button type="submit" class="button-red" style="background-color: #8B0000; padding: 8px 15px;" onclick="return confirm('¿Estás seguro? Se eliminarán también todas las keys asociadas.');">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="5" style="text-align: center; color:#FFCC00; padding: 20px; font-weight: bold;">No hay productos registrados.</td></tr>
            {% endif %}
        </tbody>
    </table>
{% endblock %}